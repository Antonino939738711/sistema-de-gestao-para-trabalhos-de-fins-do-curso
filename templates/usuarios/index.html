{% load static %}
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Portal ISPB — Acesso Seguro</title>
  <script src="{% static 'css/3.4.js' %}"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

  <style>
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>

<body class="bg-black text-gray-200 min-h-screen font-sans selection:bg-cyan-400 selection:text-black">

<!-- LOADER -->
<div id="loader"
     role="alert"
     aria-live="assertive"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 hidden">
  <div class="flex flex-col items-center gap-4">
    <div class="w-16 h-16 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin"></div>
    <span class="text-cyan-400 font-semibold tracking-wide">A autenticar…</span>
  </div>
</div>

<section class="relative min-h-screen flex items-center justify-center bg-cover bg-center"
         style="background-image:url('{% static "imgs/teste.jpg" %}');">

  <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>

  <main class="relative z-10 w-full max-w-md mx-4 bg-gray-900/80 backdrop-blur-xl
               rounded-3xl shadow-2xl p-8 animate-[fadeIn_0.6s_ease-out]">

    <!-- LOGO -->
    <div class="text-center mb-6">
      <img src="{% static 'imgs/icons/finalispbie.jpg' %}"
           alt="Portal ISPB"
           class="mx-auto w-24 h-24 rounded-full border-4 border-cyan-400 shadow-lg">
      <h1 class="mt-4 text-2xl font-bold text-white">Bem-vindo ao Portal ISPB</h1>
      <p class="text-sm text-gray-400">Acesso seguro e institucional</p>
    </div>

    <!-- MENSAGENS DJANGO -->
    {% if messages %}
      <div class="mb-4 space-y-2" role="alert">
        {% for message in messages %}
          <div class="px-4 py-3 rounded-lg text-sm font-medium
            {% if message.tags == 'error' %}bg-red-500/15 text-red-400 border border-red-500/30 text-center
            {% elif message.tags == 'success' %}bg-green-500/15 text-green-400 border border-green-500/30 text-center
            {% else %}bg-gray-500/15 text-gray-300 border border-gray-500/30 text-center {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- FORM -->
    <form method="post" id="loginForm" class="space-y-5">
      {% csrf_token %}

      <!-- EMAIL -->
      <div>
        <label for="email" class="block text-sm font-medium text-gray-300">
          Email
        </label>

        <input id="email"
               name="username"
               type="email"
               required
               aria-label="Email"
               aria-describedby="emailHelp"
               aria-invalid="false"
               class="mt-1 w-full px-4 py-3 rounded-xl bg-gray-800 text-white
                      border border-gray-700
                      focus:outline-none focus:ring-2 focus:ring-cyan-400 transition">

        <p id="emailHelp" class="mt-1 text-sm hidden"></p>
      </div>

      <!-- SENHA -->
      <div class="relative">
        <label for="senha" class="block text-sm font-medium text-gray-300">
          Senha
        </label>

        <input id="senha"
               name="senha"
               type="password"
               required
               aria-label="Senha"
               class="mt-1 w-full px-4 py-3 rounded-xl bg-gray-800 text-white
                      border border-gray-700
                      focus:outline-none focus:ring-2 focus:ring-cyan-400 transition">

        <button type="button"
                id="togglePwd"
                aria-label="Mostrar ou ocultar senha"
                class="absolute right-4 top-10 text-gray-400 hover:text-cyan-400 transition">
          <i id="iconEye" class="bx bx-hide text-xl"></i>
        </button>
      </div>

      <!-- BOTÃO -->
      <button type="submit"
              id="submitBtn"
              class="w-full py-3 rounded-xl bg-cyan-400 text-black font-bold
                     hover:bg-cyan-300 active:scale-95 transition-all
                     focus:outline-none focus:ring-2 focus:ring-cyan-500">
        Entrar no Sistema
      </button>
    </form>

    <p class="mt-6 text-center text-sm text-gray-400">
      Não tem conta?
      <a href="{% url 'cadastro' %}"
         class="text-cyan-400 font-semibold hover:underline focus:outline-none focus:ring-2 focus:ring-cyan-400 rounded">
        Criar conta
      </a>
    </p>
  </main>
</section>

<script>
  // Toggle senha
  const togglePwd = document.getElementById("togglePwd");
  const senha = document.getElementById("senha");
  const icon = document.getElementById("iconEye");

  togglePwd.addEventListener("click", () => {
    const isPassword = senha.type === "password";
    senha.type = isPassword ? "text" : "password";
    icon.className = isPassword ? "bx bx-show text-xl" : "bx bx-hide text-xl";
  });

  // Loader
  const form = document.getElementById("loginForm");
  const loader = document.getElementById("loader");

  form.addEventListener("submit", () => {
    loader.classList.remove("hidden");
  });

  // VALIDAÇÃO DINÂMICA DO EMAIL
  const emailInput = document.getElementById("email");
  const emailHelp = document.getElementById("emailHelp");
  const submitBtn = document.getElementById("submitBtn");

  function validarEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  emailInput.addEventListener("input", () => {
    const email = emailInput.value.trim();

    if (email === "") {
      emailHelp.className = "mt-1 text-sm hidden";
      emailInput.setAttribute("aria-invalid", "false");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-50", "cursor-not-allowed");
      return;
    }

    if (!validarEmail(email)) {
      emailHelp.textContent = "Email Inválido , exemplo@dominio";
      emailHelp.className = "mt-1 text-sm text-red-400";
      emailInput.setAttribute("aria-invalid", "true");
      submitBtn.disabled = true;
      submitBtn.classList.add("opacity-50", "cursor-not-allowed");
    } else {
      emailHelp.textContent = "Email Válido";
      emailHelp.className = "mt-1 text-sm text-green-400";
      emailInput.setAttribute("aria-invalid", "false");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-50", "cursor-not-allowed");
    }
  });
</script>

</body>
</html>
